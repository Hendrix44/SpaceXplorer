<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>R√©server une mission</title>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<header>
    <h1>R√©servation de mission</h1>
    <nav>
        <a href="index.html">Accueil</a>
        <a href="catalogue.html">Catalogue</a>
    </nav>
</header>

<main>
    <!-- Section de cr√©ation de mission -->
    <section id="createMission">
        <h2>Cr√©er une Mission</h2>
        <form id="reservationForm">
            <label for="planet">Plan√®te :</label>
            <select id="planet" name="planet_id" required></select>

            <label for="explorer">ID Explorateur :</label>
            <input type="number" id="explorer" name="explorer_id" required />

            <label for="departure_date">Date de d√©part :</label>
            <input type="date" id="departure_date" name="departure_date" required />

            <label for="duration">Dur√©e (jours) :</label>
            <input type="number" id="duration" name="duration" required />

            <button type="submit">R√©server</button>
        </form>
    </section>

    <!-- Section d'affichage des missions existantes (cach√©e au d√©part) -->
    <section id="missionsList" style="display: none;">
        <h2>Liste des Missions R√©serv√©es</h2>
        <div id="missionsContainer">
            <!-- Les missions seront affich√©es ici -->
        </div>
    </section>

    <!-- Bouton pour afficher/masquer les missions -->
    <button id="toggleMissionsBtn">Afficher les missions</button>
</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const reservationForm = document.getElementById('reservationForm');
        const planetSelect = document.getElementById('planet');
        const missionsContainer = document.getElementById('missionsContainer');
        const toggleMissionsBtn = document.getElementById('toggleMissionsBtn');
        const missionsListSection = document.getElementById('missionsList');

        // Charger les plan√®tes dans le <select>
        fetch('/api/planets')
            .then(res => res.json())
            .then(planets => {
                planets.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = p.name;
                    planetSelect.appendChild(option);
                });
            });

        // G√©rer la soumission du formulaire de cr√©ation de mission
        reservationForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                planet_id: reservationForm.planet_id.value,
                explorer_id: reservationForm.explorer_id.value,
                departure_date: reservationForm.departure_date.value,
                duration: reservationForm.duration.value
            };

            const response = await fetch('/api/missions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('üöÄ Mission r√©serv√©e avec succ√®s !');
                reservationForm.reset();
            } else {
                const error = await response.text();
                alert('‚ùå Erreur : ' + error);
            }
        });

        // Fonction pour charger toutes les missions existantes
        function loadMissions() {
            fetch('/api/missions')
                .then(res => res.json())
                .then(missions => {
                    if (missions.length === 0) {
                        missionsContainer.innerHTML = '<p>Aucune mission r√©serv√©e pour le moment.</p>';
                        return;
                    }

                    missionsContainer.innerHTML = missions.map(mission => {
                        return `
                            <div class="mission-card">
                                <h3>Mission ID: ${mission.id}</h3>
                                <p><strong>Plan√®te :</strong> ${mission.planet_id}</p>
                                <p><strong>Explorateur ID :</strong> ${mission.explorer_id}</p>
                                <p><strong>Date de d√©part :</strong> ${mission.departure_date}</p>
                                <p><strong>Dur√©e :</strong> ${mission.duration} jours</p>
                                <p><strong>Status :</strong> ${mission.status}</p>
                            </div>
                        `;
                    }).join('');
                })
                .catch(err => {
                    missionsContainer.innerHTML = '<p>Erreur de r√©cup√©ration des missions.</p>';
                    console.error(err);
                });
        }

        // Fonction pour afficher ou masquer les missions
        toggleMissionsBtn.addEventListener('click', () => {
            const isVisible = missionsListSection.style.display === 'block';
            if (isVisible) {
                // Cacher la section des missions
                missionsListSection.style.display = 'none';
                toggleMissionsBtn.textContent = 'Afficher les missions';  // Modifier le texte du bouton
            } else {
                // Afficher la section des missions
                missionsListSection.style.display = 'block';
                toggleMissionsBtn.textContent = 'Masquer les missions';  // Modifier le texte du bouton
                loadMissions();  // Charger les missions
            }
        });
    });
</script>

</body>
</html>
